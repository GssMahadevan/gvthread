# benches/httpd/manifest.yml — HTTP server benchmark manifest
#
# Common section is LAW: every app gets identical common params.
# App config is ADDITIVE: only runtime-specific knobs.
# Port is PER-APP: avoids TCP TIME_WAIT between sequential runs.
#
# bench-runner exports:
#   common keys  → gvt_{K}={V}
#   app keys     → gvt_app_{K}={V}     (includes gvt_app_port)
#
# Apps read gvt_parallelism for threads/workers/GOMAXPROCS.
# Apps read gvt_app_port for listen port.
# taskset enforces gvt_cpu_cores externally.

common:
  light:
    desc: "Quick sanity — laptop / CI"
    # cpu_cores: 2
    parallelism: 2
    warmup_sec: 2
    measure_sec: 5
    keepalive: true
    wrk_threads: 2
    wrk_connections: 50

  medium:
    desc: "Dev VM — moderate load"
    # cpu_cores: 4
    parallelism: 4
    warmup_sec: 3
    measure_sec: 10
    keepalive: true
    wrk_threads: 4
    wrk_connections: 200

  heavy:
    desc: "Bare metal — saturate 8 cores"
    # cpu_cores: 8
    parallelism: 8
    warmup_sec: 5
    measure_sec: 30
    keepalive: true
    wrk_threads: 8
    wrk_connections: 1000

  nokeep:
    desc: "Connection-per-request storm (4 cores)"
    # cpu_cores: 4
    parallelism: 4
    warmup_sec: 3
    measure_sec: 10
    keepalive: false
    wrk_threads: 4
    wrk_connections: 500

apps:
  ksvc-httpd:
    lang: rust
    binary: target/release/ksvc-httpd
    port: 8080
    model: event-loop
    io: io_uring
    configs:
      - name: default
      - name: big-ring
        sq_entries: 2048

  gvthread0-httpd:
    lang: rust
    binary: target/release/gvthread0-httpd
    port: 8081
    model: green-thread
    io: io_uring
    configs:
      - name: default
      - name: big-ring
        sq_entries: 2048
        max_gvthreads: 200000


  gvthread1-httpd:
    lang: rust
    binary: target/release/gvthread1-httpd
    port: 8084
    model: green-thread
    io: io_uring
    configs:
      - name: default
      - name: big-ring
        sq_entries: 2048
        max_gvthreads: 200000

  tokio-httpd:
    lang: rust
    binary: target/release/tokio-httpd
    port: 8082
    model: async-await
    io: epoll
    configs:
      - name: default

  go-httpd:
    lang: go
    binary: cmd/httpd/go/httpd
    port: 8083
    model: goroutine
    io: epoll
    configs:
      - name: naive
        variant: naive
      - name: pooled
        variant: pooled

  # Future: uncomment when ready
  # go-gin-httpd:
  #   lang: go
  #   binary: cmd/httpd/go-gin/httpd
  #   model: goroutine
  #   io: epoll
  #   configs:
  #     - name: default

  # go-fiber-httpd:
  #   lang: go
  #   binary: cmd/httpd/go-fiber/httpd
  #   model: fiber
  #   io: epoll
  #   configs:
  #     - name: default